<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cake Tracker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fafafa;
    color: #222;
    text-align: center;
    padding: 20px;
  }
  h1 { font-size: 24px; margin-bottom: 5px; }
  #countdown { font-size: 16px; margin-bottom: 20px; }
  .cakes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 10px;
    max-width: 600px;
    margin: 0 auto 30px auto;
  }
  .cake {
    position: relative;
    background: #fff;
    border-radius: 8px;
    border: 1px solid #ccc;
    padding: 10px 0;
    cursor: pointer;
    font-size: 14px;
    transition: 0.2s;
  }
  .cake.owned { background: #c8e6c9; border-color: #4caf50; }
  .cake:hover { background: #f0f0f0; }
  .plus {
    position: absolute;
    top: 3px;
    right: 5px;
    font-weight: bold;
    font-size: 18px;
    color: #444;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    table-layout: fixed;
  }
  td {
    padding: 6px;
    text-align: center;
    vertical-align: top;
  }
  .owned-title, .missing-title {
    margin-top: 30px;
    font-size: 20px;
    text-decoration: underline;
  }
</style>
</head>
<body>
  <h1>Cake Tracker</h1>
  <div id="countdown"></div>
  <div class="cakes-grid" id="cakesGrid"></div>

  <div class="owned-title">Owned Cakes</div>
  <table id="ownedTable"></table>

  <div class="missing-title">Missing Cakes</div>
  <table id="missingTable"></table>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const totalCakesBase = 250;
  const lastRelease = new Date("2025-11-05T12:00:00Z");
  const intervalHours = 124;
  const grid = document.getElementById("cakesGrid");
  const ownedTable = document.getElementById("ownedTable");
  const missingTable = document.getElementById("missingTable");
  const countdown = document.getElementById("countdown");

  function ordinal(n) {
    const s=["th","st","nd","rd"], v=n%100;
    return n+(s[(v-20)%10]||s[v]||s[0]);
  }

  function calcTotal() {
    const now = new Date();
    const diffHours = (now - lastRelease) / (1000 * 60 * 60);
    return totalCakesBase + Math.floor(diffHours / intervalHours);
  }

  function updateCountdown() {
    const total = calcTotal();
    const nextRelease = new Date(lastRelease.getTime() + (total - totalCakesBase + 1) * intervalHours * 3600000);
    const diff = nextRelease - new Date();
    if (diff <= 0) return;
    const d = Math.floor(diff / 86400000);
    const h = Math.floor((diff % 86400000) / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    countdown.textContent = `Next cake in ${d}d ${h}h ${m}m`;
  }

  function renderGrid() {
    const total = calcTotal();
    const owned = JSON.parse(localStorage.getItem("ownedCakes") || "[]");
    grid.innerHTML = "";
    for (let i = 1; i <= total; i++) {
      const div = document.createElement("div");
      div.className = "cake" + (owned.includes(i) ? " owned" : "");
      div.dataset.id = i;
      div.innerHTML = `<span>${ordinal(i)}</span><span class="plus">+</span>`;
      grid.appendChild(div);
    }
    renderTables();
  }

  function makeTable(arr, table) {
    table.innerHTML = "";
    if (!arr.length) return;
    const columns = 3;
    for (let i = 0; i < arr.length; i += columns) {
      const row = document.createElement("tr");
      for (let j = 0; j < columns; j++) {
        const td = document.createElement("td");
        if (arr[i + j]) td.textContent = ordinal(arr[i + j]);
        row.appendChild(td);
      }
      table.appendChild(row);
    }
  }

  function renderTables() {
    const total = calcTotal();
    const owned = JSON.parse(localStorage.getItem("ownedCakes") || "[]");
    const all = Array.from({length: total}, (_, i) => i + 1);
    const missing = all.filter(i => !owned.includes(i));
    makeTable(owned, ownedTable);
    makeTable(missing, missingTable);
  }

  grid.addEventListener("click", e => {
    const cakeDiv = e.target.closest(".cake");
    if (!cakeDiv) return;
    const id = parseInt(cakeDiv.dataset.id);
    let owned = JSON.parse(localStorage.getItem("ownedCakes") || "[]");
    if (owned.includes(id)) owned = owned.filter(x => x !== id);
    else owned.push(id);
    localStorage.setItem("ownedCakes", JSON.stringify(owned));
    renderGrid();
  });

  renderGrid();
  updateCountdown();
  setInterval(updateCountdown, 60000);
});
</script>
</body>
</html>